---
id: setup
title: Backend-Rendered Apps Setup Guide
sidebar_label: Setup for Development
description: "Step-by-step setup for Tolgee in-context editing in PHP, Rails, Django, and other server-rendered apps. Includes invisible key wrapping, observer configuration, and CLI sync."
keywords: [backend setup, SSR localization setup, PHP i18n setup, invisible wrapping, Tolgee CLI watch mode, server-side translation]
---

This guide walks you through setting up Tolgee for backend-rendered applications in your **local development environment**.

:::info When to use this guide
This setup is for **local development** where you (the developer) are the only one who sees the page. The API key is output to the HTML, which is fine for development but not suitable for production.

Once you have this working, see [Setup Editing in Production](./production-editing.mdx) if you want translators to edit translations on your live site.
:::

## What you'll set up

- **Backend**: Wrap translations with invisible characters (the main work)
- **Frontend**: Add Tolgee JS to detect wrapped strings (a few lines)
- **CLI**: Run in watch mode to sync translation changes (one command)

## Prerequisites

- A Tolgee project with an API key (create one at [app.tolgee.io](https://app.tolgee.io))
- Docker and Docker Compose (recommended for running the CLI)

---

## Quick start

Want to get something working fast? Here's the minimal setup:

**1. Backend wrapper** (PHP example—adapt for your language):

```php
class InvisibleWrapper {
    public function wrap($key, $translation) {
        $data = json_encode(['k' => $key, 'n' => '']) . "\x0A";
        $result = '';
        foreach (unpack('C*', $data) as $byte) {
            $binary = str_pad(decbin($byte), 8, '0', STR_PAD_LEFT) . '0';
            for ($i = 0; $i < 9; $i++) {
                $result .= $binary[$i] === '0' ? "\u{200C}" : "\u{200D}";
            }
        }
        return $translation . $result;
    }
}

// Usage: echo $wrapper->wrap('greeting', 'Hello!');
```

**2. Frontend** (add to your HTML in dev mode):

```html
<script src="https://cdn.jsdelivr.net/npm/@tolgee/web/dist/tolgee-web.development.umd.min.js"></script>
<script>
  const { Tolgee, DevTools, ObserverPlugin } = window['@tolgee/web'];
  Tolgee()
    .use(DevTools())
    .use(ObserverPlugin())
    .init({
      language: 'en',
      apiUrl: 'https://app.tolgee.io',
      apiKey: 'YOUR_API_KEY',
      observerOptions: { fullKeyEncode: true }
    })
    .run();
</script>
```

**3. CLI** (sync changes):

```bash
tolgee pull --watch
```

That's it! Hold Alt/Option and click any wrapped text to edit. For production-ready code with proper error handling, namespaces, and ICU formatting, see the detailed sections below.

---

## Step 1: Implement invisible key wrapping

Your backend needs to append invisible characters to each translation that encode the translation key. This allows Tolgee JS to identify which key produced each piece of text.

The encoding converts key metadata to binary, mapping each bit to an invisible Unicode character:
- `0` → Zero-Width Non-Joiner (`\u200C`)
- `1` → Zero-Width Joiner (`\u200D`)

### Full wrapper implementation (PHP)

Adapt this to your backend language:

```php
class InvisibleWrapper
{
    const INVISIBLE_CHARACTERS = ["\u{200C}", "\u{200D}"];
    const MESSAGE_END = "\x0A";

    /**
     * Wraps a translation with invisible encoded key data.
     * Call this in development mode only.
     */
    public function wrap($key, $namespace, $translation)
    {
        $data = json_encode([
            'k' => $key,
            'n' => $namespace ?: ''
        ]);

        return $translation . $this->encodeToInvisible($data . self::MESSAGE_END);
    }

    private function encodeToInvisible($text)
    {
        $result = '';
        $bytes = unpack('C*', $text);

        foreach ($bytes as $byte) {
            // Convert byte to 8-bit binary, then add separator bit
            $binary = str_pad(decbin($byte), 8, '0', STR_PAD_LEFT) . '0';

            for ($i = 0; $i < strlen($binary); $i++) {
                $result .= self::INVISIBLE_CHARACTERS[(int)$binary[$i]];
            }
        }

        return $result;
    }
}
```

### Using the wrapper

Only wrap translations in development mode. In production, serve translations without the invisible characters.

<details>
<summary>Full Translator class with ICU MessageFormat support</summary>

This class supports ICU MessageFormat for plurals, select, and other advanced formatting. It requires PHP's `intl` extension, with a fallback to simple parameter replacement if unavailable.

```php
class Translator
{
    private $translations;
    private $wrapper;
    private $isDevelopment;
    private $language;

    public function __construct($language, $isDevelopment = false)
    {
        $this->language = $language;
        $this->translations = $this->loadTranslations($language);
        $this->wrapper = new InvisibleWrapper();
        $this->isDevelopment = $isDevelopment;
    }

    public function t($key, $params = [], $namespace = null)
    {
        $translation = $this->translations[$key] ?? $key;

        // Use ICU MessageFormat if we have parameters
        if (!empty($params)) {
            $formatted = $this->formatWithICU($translation, $params);
            if ($formatted !== null) {
                $translation = $formatted;
            } else {
                // Fallback to simple replacement for non-ICU strings or on error
                $translation = $this->simpleReplace($translation, $params);
            }
        }

        if ($this->isDevelopment) {
            $translation = $this->wrapper->wrap($key, $namespace, $translation);
        }

        return $translation;
    }

    private function formatWithICU($message, $params)
    {
        if (!class_exists('MessageFormatter')) {
            return null;
        }

        $formatter = MessageFormatter::create($this->language, $message);
        if ($formatter === null) {
            return null;
        }

        $result = $formatter->format($params);
        return $result === false ? null : $result;
    }

    private function simpleReplace($message, $params)
    {
        foreach ($params as $key => $value) {
            $message = str_replace('{' . $key . '}', (string)$value, $message);
        }
        return $message;
    }

    private function loadTranslations($language)
    {
        $file = __DIR__ . '/i18n/' . $language . '.json';
        return file_exists($file)
            ? json_decode(file_get_contents($file), true)
            : [];
    }
}
```

**Installing the intl extension** (for ICU MessageFormat):

```dockerfile
RUN apt-get update && apt-get install -y libicu-dev \
    && docker-php-ext-install intl
```

If you only need simple `{placeholder}` replacements, skip the extension and remove the `formatWithICU` method.

</details>

### Namespaces

The `namespace` parameter organizes translations into logical groups. Pass it when calling the translator:

```php
$translator->t('save_button', [], 'common');     // Key in namespace "common"
$translator->t('not_found', [], 'errors');       // Key in namespace "errors"
```

If you don't use namespaces, omit the parameter or pass `null`.

### Example usage

```php
// Development mode
$translator = new Translator('en', isDevelopment: true);

echo $translator->t('welcome');
// Output: "Welcome to our app" + invisible characters

echo $translator->t('greeting', ['name' => 'John']);
// Output: "Hello, John!" + invisible characters

// Production mode
$translator = new Translator('en', isDevelopment: false);
echo $translator->t('welcome');
// Output: "Welcome to our app"
```

:::caution Don't HTML-encode wrapped translations
Avoid `htmlspecialchars()` or similar encoding on wrapped translations. The invisible Unicode characters are safe for HTML, but encoding them corrupts the binary data and breaks key detection.

If you need HTML escaping, apply it **before** wrapping, or ensure your escaping preserves these specific Unicode characters.
:::

---

## Step 2: Initialize Tolgee JS with the Observer

Add the Tolgee Web SDK to your HTML pages in development mode only. The `ObserverPlugin` watches the DOM for wrapped translations and enables in-context editing.

Determine development mode by checking for the `TOLGEE_API_KEY` environment variable:

```php
<?php $isDevelopment = !empty(getenv('TOLGEE_API_KEY')); ?>
```

Then conditionally include Tolgee JS:

```html
<?php if ($isDevelopment): ?>
<script src="https://cdn.jsdelivr.net/npm/@tolgee/web/dist/tolgee-web.development.umd.min.js"></script>
<script>
  const { Tolgee, DevTools, ObserverPlugin } = window['@tolgee/web'];

  Tolgee()
    .use(DevTools())
    .use(ObserverPlugin())
    .init({
      language: 'en',
      apiUrl: 'https://app.tolgee.io',
      apiKey: '<?= getenv('TOLGEE_API_KEY') ?>',
      observerOptions: { fullKeyEncode: true }
    })
    .run();
</script>
<?php endif; ?>
```

### Configuration options

| Option | Description |
|--------|-------------|
| `apiUrl` | Your Tolgee instance. Use `https://app.tolgee.io` for Tolgee Cloud, or your self-hosted URL. |
| `apiKey` | Your project API key with in-context editing permissions. |
| `observerOptions.fullKeyEncode` | Must be `true` to detect invisible-wrapped strings. |

:::tip How to use in-context editing
Hold **Alt** (Windows/Linux) or **Option** (Mac) and **click** any translated text to open the editor.
:::

:::warning Keep backend and frontend in sync
Both backend wrapping and frontend Tolgee JS must be enabled together. If out of sync, invisible characters remain in HTML and cause issues when users copy/paste text.
:::

:::caution API key security
The API key in client-side JavaScript is visible to anyone viewing your page source:

- Only set `TOLGEE_API_KEY` in development environments
- Never commit API keys to version control
- Use scoped keys with minimal permissions
:::

---

## Step 3: Keep translations in sync

The Tolgee CLI pulls translations to local files and watches for changes, keeping your filesystem in sync with the platform.

### CLI configuration

Create `.tolgeerc.json` in your project root:

```json
{
  "$schema": "https://docs.tolgee.io/cli-schema.json",
  "projectId": 12345,
  "format": "JSON_TOLGEE",
  "languages": ["en", "cs", "fr", "de"],
  "pull": {
    "path": "./i18n"
  }
}
```

| Option | Description |
|--------|-------------|
| `projectId` | Your project ID from `app.tolgee.io/projects/{projectId}` |
| `format` | Output format. `JSON_TOLGEE` creates simple `{"key": "translation"}` files. See [CLI formats](/tolgee-cli/project-configuration#format). |
| `languages` | Languages to pull (omit for all project languages). |
| `pull.path` | Where to save translation files (relative to config). |

### Running the CLI

**Directly:**
```bash
tolgee pull --watch
```

**With Docker:**
```bash
docker run -v .:/app -e TOLGEE_API_KEY=your-key tolgee/cli pull --watch
```

<details>
<summary>Docker Compose configuration</summary>

Run alongside your app:

```yaml
services:
  tolgee-cli:
    image: tolgee/cli
    volumes:
      - ./i18n:/app/i18n
      - ./.tolgeerc.json:/app/.tolgeerc.json:ro
    environment:
      - TOLGEE_API_KEY=${TOLGEE_API_KEY}
    command: pull --path /app/i18n --watch
```

When using Docker, mount only the translation directory and use command-line arguments for paths. Alternatively, use absolute paths in your config:

```json
{
  "projectId": 12345,
  "format": "JSON_TOLGEE",
  "pull": {
    "path": "/app/i18n"
  }
}
```

</details>

The CLI watches for platform changes and updates your local files automatically. Refresh the page to see updated translations.

---

## Troubleshooting

### Invisible characters appear in copy/pasted text

The backend is wrapping translations but Tolgee JS isn't running. Ensure both are enabled together.

### In-context editing doesn't work

1. Verify `observerOptions.fullKeyEncode` is `true`
2. Check that your backend is actually wrapping strings (inspect HTML source for invisible characters after translated text)
3. Confirm the API key has in-context editing permissions

### Changes don't appear after editing

This is expected—refresh the page. The CLI must also be running in watch mode to pull changes to your local files.

### Wrapped strings break HTML attributes

Don't use wrapped translations in HTML attributes like `title` or `alt`. The invisible characters are safe in text content but may cause issues in attributes. For attributes, use unwrapped translations.

---

## Complete example

For a working reference implementation, see the [PHP example repository](https://github.com/tolgee/tolgee-php-demo). It demonstrates all concepts from this guide in a minimal PHP application.

## Next steps

Once you have the basic setup working, see [Setup Editing in Production](./production-editing.mdx) to enable translation editing for your team on your live site without exposing API keys to end users.
